<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Music Downloader</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
* {margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body {background:#fff;color:#000;padding:20px;}
.container {max-width:1200px;margin:auto;}
header {display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
.search-container {display:flex;gap:10px;width:100%;max-width:600px;}
#searchInput {flex:1;padding:8px;border:1px solid #ccc;}
#searchBtn {padding:8px 12px;background:#eee;border:1px solid #ccc;cursor:pointer;}
.results-container {display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px;}
.song-card {border:1px solid #ddd;padding:10px;}
.thumbnail {max-width:100%;height:auto;}
.player-container {position:fixed;bottom:0;left:0;right:0;border-top:1px solid #ddd;padding:10px;display:none;align-items:center;gap:10px;background:#fff;}
.player-info {display:flex;align-items:center;gap:10px;flex:1;}
.player-thumbnail {width:40px;height:40px;}
.player-controls {display:flex;gap:10px;}
.control-btn {background:none;border:none;font-size:20px;cursor:pointer;}
.progress-container {flex:2;height:5px;background:#ddd;cursor:pointer;}
.progress-bar {height:100%;background:#000;width:0%;}
.loading {display:none;text-align:center;padding:20px;}
</style>
</head>
<body>

<div class="container">
  <header>
    <h1>Music Downloader</h1>
    <div class="search-container">
      <input id="searchInput" type="text" placeholder="Search…">
      <button id="searchBtn">Search</button>
    </div>
  </header>

  <div class="loading" id="loading">Loading…</div>
  <div class="results-container" id="results"></div>
</div>

<div class="player-container" id="player">
  <div class="player-info">
    <img class="player-thumbnail" id="playerThumb" src="">
    <span id="playerTitle"></span>
  </div>
  <div class="player-controls">
    <button class="control-btn" onclick="playPause()"><i id="playIcon" class="fa fa-play"></i></button>
    <button class="control-btn" onclick="stop()"><i class="fa fa-stop"></i></button>
    <button class="control-btn" onclick="rewind()"><i class="fa fa-backward"></i></button>
    <button class="control-btn" onclick="forward()"><i class="fa fa-forward"></i></button>
  </div>
  <div class="progress-container" onclick="seek(event)"><div class="progress-bar" id="progress"></div></div>
</div>

<audio id="audio" src=""></audio>

<script>
const YT_SEARCH_URL = 'https://noobs-api.top/dipto/ytSearch';
const DOWNLOAD_MP3   = 'https://noobs-api.top/dipto/ytDl3?link=';
const searchInput = document.getElementById('searchInput');
const searchBtn   = document.getElementById('searchBtn');
const loading     = document.getElementById('loading');
const resultsDiv  = document.getElementById('results');
const playerDiv   = document.getElementById('player');
const audioEl     = document.getElementById('audio');
const playIcon    = document.getElementById('playIcon');
const progressBar = document.getElementById('progress');

let currentTrack = null;
let isPlaying    = false;

searchBtn.addEventListener('click', () => {
  const q = searchInput.value.trim();
  if (!q) return alert('Enter a search term');
  fetchResults(q);
});

async function fetchResults(query) {
  loading.style.display = 'block';
  resultsDiv.innerHTML = '';
  try {
    const resp = await fetch(`${YT_SEARCH_URL}?q=${encodeURIComponent(query)}`);
    const data = await resp.json();
    loading.style.display = 'none';
    if (!data.videos?.length) {
      resultsDiv.innerHTML = '<div class="loading">No videos found.</div>';
      return;
    }
    data.videos.forEach(v => {
      const card = document.createElement('div');
      card.className = 'song-card';
      const safeTitle = v.title.replace(/[\\/:*?"<>|]/g, '_');
      card.innerHTML = `
        <img class="thumbnail" src="${v.thumbnail}">
        <h3>${v.title}</h3>
        <button onclick="loadTrack('${safeTitle}','${DOWNLOAD_MP3}${v.videoId}&format=mp3','${v.thumbnail}')">Audio</button>
        <button onclick="window.open('https://www.youtube.com/watch?v=${v.videoId}','_blank')">Video</button>
      `;
      resultsDiv.appendChild(card);
    });
  } catch (err) {
    loading.style.display = 'none';
    resultsDiv.innerHTML = `<div class="loading">Error: ${err.message}</div>`;
  }
}

function loadTrack(title, url, thumb) {
  currentTrack = {title, url, thumb};
  audioEl.src = url;
  audioEl.load();
  document.getElementById('playerTitle').textContent = title;
  document.getElementById('playerThumb').src = thumb;
  playerDiv.style.display = 'flex';
  audioEl.addEventListener('timeupdate', () => {
    const pct = (audioEl.currentTime / audioEl.duration) * 100;
    progressBar.style.width = `${pct}%`;
  });
  playPause();
}

function playPause() {
  if (!currentTrack) return;
  if (isPlaying) {
    audioEl.pause();
    playIcon.className = 'fa fa-play';
  } else {
    audioEl.play();
    playIcon.className = 'fa fa-pause';
  }
  isPlaying = !isPlaying;
}
function stop() { audioEl.pause(); audioEl.currentTime = 0; playIcon.className = 'fa fa-play'; isPlaying = false; progressBar.style.width = '0%'; }
function rewind() { audioEl.currentTime = Math.max(0, audioEl.currentTime - 10); }
function forward() { audioEl.currentTime = Math.min(audioEl.duration, audioEl.currentTime + 10); }
function seek(e) {
  const rect = e.currentTarget.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const pct = Math.min(100, Math.max(0, (x / rect.width) * 100));
  audioEl.currentTime = (pct / 100) * audioEl.duration;
  progressBar.style.width = `${pct}%`;
}
</script>
</body>
  </html> 
